<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Nimiq Iqon Builder</title>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Muli:400,700">
    <style type="text/css">
        html,
        body {
            /* Nimiq color palette */
            --nimiq-blue:       #1F2348; /* rgb(31, 35, 72) */
            --nimiq-light-blue: #0582CA; /* rgb(5, 130, 202) */
            --nimiq-gold:       #E9B213; /* rgb(233, 178, 19) */
            --nimiq-green:      #21BCA5; /* rgb(33, 188, 165) */
            --nimiq-orange:     #FC8702; /* rgb(252, 135, 2) */
            --nimiq-red:        #D94432; /* rgb(216, 65, 51) */
            --nimiq-gray:       #F4F4F5;
            --nimiq-light-gray: #FAFAFA;

            /* Background gradients */
            --nimiq-blue-bg:       radial-gradient(circle at bottom right, #260133, var(--nimiq-blue));
            --nimiq-light-blue-bg: radial-gradient(circle at bottom right, #265DD7, var(--nimiq-light-blue));
            --nimiq-gold-bg:       radial-gradient(circle at bottom right, #EC991C, var(--nimiq-gold));
            --nimiq-green-bg:      radial-gradient(circle at bottom right, #41A38E, var(--nimiq-green));
            --nimiq-orange-bg:     radial-gradient(circle at bottom right, #FD6216, var(--nimiq-orange));
            --nimiq-red-bg:        radial-gradient(circle at bottom right, #CC3047, var(--nimiq-red));
            --nimiq-gray-bg:       radial-gradient(circle at bottom right, #F4F4F4, var(--nimiq-gray));

            background: var(--nimiq-gray);
            background-image: var(--nimiq-gray-bg);
            text-align: center;
            color: var(--nimiq-blue);
            font-family: 'Muli', system-ui, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }

        body {
            padding: 32px;
            max-width: 960px;
            margin: 0 auto;
            font-size: 16px;
        }

        h1 {
            font-weight: 700;
            font-size: 32px;
            margin-bottom: 32px;
        }

        label {
            display: block;
            margin-top: 16px;
            margin-bottom: 4px;
        }

        .float-left {
            float: left;
        }

        #settings {
            text-align: left;
            margin-bottom: 40px;
            overflow: auto;
        }

        #settings > div:first-child {
            width: 60%;
        }

        #settings > div:last-child {
            width: 40%;
        }

        .colors {
            overflow: auto;
        }

        .colors div {
            float: left;
            width: 32px;
            height: 32px;
            margin-right: 4px;
            border-radius: 50%;
            border: 4px solid var(--nimiq-light-gray);
            cursor: pointer;
        }

        .feature {
            width: 50%;
        }

        select {
            font-size: inherit;
            padding: 5px 10px;
        }

        img {
            width: 100%;
            height: 100%;
        }

        .iqon {
            width: 320px;
            height: 320px;
            max-width: 100%;
            display: inline-block;
            margin: 16px 0;
        }

        .iqon.smaller {
            width: 160px;
            height: 160px;
            margin-left: -30px;
        }

        .iqon.small {
            width: 80px;
            height: 80px;
            margin-left: -10px;
        }

        @media (max-width: 800px) {
            body {
                padding: 16px;
            }

            #settings > div {
                float: none;
                width: 100% !important;
            }
        }
    </style>
</head>
<body>
    <h1>Nimiq Iqon Builder</h1>

    <div id="settings">
        <div class="float-left">
            <label>Background</label>
            <div class="colors background"></div>

            <label>Body</label>
            <div class="colors body"></div>

            <label>Accent</label>
            <div class="colors accent"></div>
        </div>
        <div class="float-left">
            <div class="feature float-left">
                <label>Top</label>
                <select top></select>
            </div>
            <div class="feature float-left">
                <label>Face</label>
                <select face></select>
            </div>
            <div class="feature float-left">
                <label>Side</label>
                <select side></select>
            </div>
            <div class="feature float-left">
                <label>Bottom</label>
                <select bottom></select>
            </div>
        </div>
    </div>

    <div class="iqon"></div>
    <div class="iqon smaller"></div>
    <div class="iqon small"></div>

    <script type="module">
        import Iqons from './src/js/iqons.js';
        import { IqonsCatalog } from './src/js/iqons-catalog.js';
        window.IqonsCatalog = IqonsCatalog;

        Iqons._getAssets().then($lib => {
            Iqons.$lib = $lib;
            window.Iqons = Iqons;

            createColorPickers();
            createFeatureSelects();
            try {
                if(!location.hash) throw('break');
                window.options = JSON.parse(decodeURIComponent('{' + location.hash.slice(1) + '}'));
                ['top', 'face', 'side', 'bottom'].map(key => {
                    document.querySelector(`select[${key}]`).value = window.options[key];
                });
            }
            catch(e) {
                window.options = {
                    backgroundColor: 0,
                    bodyColor: 0,
                    accentColor: 0,
                    top: 0,
                    face: 0,
                    side: 0,
                    bottom: 0
                };
            }
            render();
        });
    </script>
    <script>
        const iqons = document.querySelectorAll('.iqon');

        const LABELS = {
            top: [
                'Hair',
                'Antenna',
                'Leaf',
                'Chinese',
                'Bone',
                'Chef',
                'Cowboy',
                'Top hat',
                'Doctor',
                'Drop',
                'Elvis',
                'Angel',
                'Native',
                'King',
                'Wizard',
                'Mushroom',
                'Police',
                'Princess',
                'Mohawk',
                'Unicorn',
                'Winter hat',
            ],
            face: [
                'Cat',
                'Clown',
                'Sad',
                'Wink',
                'Dollar',
                'Vampire',
                'Duck',
                'Evil',
                'Hearts',
                'Dead',
                'Beard',
                'Glasses',
                'Cyclops',
                'Panda',
                'Parrot',
                'Pig',
                'Pirate',
                'Happy',
                'Stars',
                'Sunglasses',
                'Tongue',
            ],
            side: [
                'Antennae',
                'Arrow',
                'Beer',
                'Gloves',
                'Horns',
                'Spock',
                'Crab claw',
                'Wand',
                'Leafs',
                'Football',
                'Knife & Fork',
                'Ears',
                'Muscles',
                'Phone',
                'Peace!',
                'Racket',
                'Twigs',
                'Wings',
                'Headset',
                'Fins',
                'Teapot',
            ],
            bottom: [
                'Balloon',
                'Feet',
                'Bird',
                'Fly',
                'Spider',
                'Whale',
                'Leafs',
                'Guitar',
                'Highheels',
                'Shadown',
                'Octopus',
                'Lightbulb',
                'Wood leg',
                'Shoes',
                'Skateboard',
                'Skates',
                'Skis',
                'Soccer',
                'Spring',
                'Walking',
                'Wheels',
            ]
        }

        function createColorPickers() {
            const html = Iqons.colors.map((color, index) => {
                return `<div onclick="updateOption('color', ${index})" style="background: ${color};"></div>`;
            }).join('');

            document.querySelector('.colors.background').innerHTML = html.replace(/color/g, 'backgroundColor');
            document.querySelector('.colors.body').innerHTML = html.replace(/color/g, 'bodyColor');
            document.querySelector('.colors.accent').innerHTML = html.replace(/color/g, 'accentColor');
        }

        function createFeatureSelects() {
            Object.keys(IqonsCatalog).map(key => {
                const html = IqonsCatalog[key].map((name, index) => {
                    return `<option value="${index}">${LABELS[key][index]}</option>`;
                }).join('');

                document.querySelector(`select[${key}]`).setAttribute('onchange', `updateOption('${key}', this.value)`);
                document.querySelector(`select[${key}]`).innerHTML = html;
            });
        }

        function updateOption(key, value) {
            options[key] = value;
            location.hash = encodeURIComponent(JSON.stringify(options).replace(/({|})/g, ''));
            render();
        }

        async function render() {
            const svg = await Iqons._svgTemplate(options.bodyColor, options.backgroundColor, options.face, options.top, options.side, options.bottom, options.accentColor, 0, true);
            const dataUrl = `data:image/svg+xml;base64,${btoa(svg)}`;

            iqons.forEach($iqon => {
                const $img = document.createElement('img');
                $img.src = dataUrl;
                if($iqon.firstChild) $iqon.removeChild($iqon.firstChild);
                $iqon.appendChild($img);
            });
        }
    </script>
</body>
</html>
